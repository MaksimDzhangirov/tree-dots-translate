# 4 –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –Ω–∞ Go

[–î–∞–Ω–Ω–∞—è —Å—Ç–∞—Ç—å—è —è–≤–ª—è–µ—Ç—Å—è –ø–µ—Ä–µ–≤–æ–¥–æ–º. –û—Ä–∏–≥–∏–Ω–∞–ª –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –ø–æ —Å—Å—ã–ª–∫–µ](https://threedots.tech/post/database-integration-testing/)

–†–æ–±–µ—Ä—Ç –õ–∞—â–∞–∫. –ì–ª–∞–≤–Ω—ã–π –∏–Ω–∂–µ–Ω–µ—Ä [Karhoo](https://www.karhoo.com/). –°–æ—É—á—Ä–µ–¥–∏—Ç–µ–ª—å
[Three Dots Labs](https://threedotslabs.com/).
–°–æ–∑–¥–∞—Ç–µ–ª—å [Watermill](https://github.com/ThreeDotsLabs/watermill).

–í—ã –∫–æ–≥–¥–∞-–Ω–∏–±—É–¥—å —Å–ª—ã—à–∞–ª–∏ –æ –ø—Ä–æ–µ–∫—Ç–µ, –≥–¥–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª–∏—Å—å –Ω–∞ 
–∫–ª–∏–µ–Ω—Ç–∞—Ö, –∫–æ—Ç–æ—Ä—ã–µ –≤–∞–º –Ω–µ –Ω—Ä–∞–≤—è—Ç—Å—è, –∏–ª–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∞—Ö, –Ω–µ –ø—Ä–∏–Ω–æ—Å—è—â–∏—Ö –ø—Ä–∏–±—ã–ª–∏?
–ò–ª–∏ –µ—â–µ —Ö—É–∂–µ ‚Äî —Ä–∞–±–æ—Ç–∞–ª–∏ –ª–∏ –í—ã –Ω–∞–¥ —Ç–∞–∫–∏–º –ø—Ä–æ–µ–∫—Ç–æ–º?

–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–∫–∞–∑–∞—Ç—å, —á—Ç–æ —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ –Ω–µ—Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ –∏ –Ω–µ–ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ. 
–¢–∞–∫–∂–µ —Å–ª–æ–∂–Ω–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å —á—Ç–æ-—Ç–æ –Ω–æ–≤–æ–µ, –ø–æ—Ç–æ–º—É —á—Ç–æ –≤—ã –±–æ–∏—Ç–µ—Å—å –≤–Ω–æ—Å–∏—Ç—å –∫–∞–∫–∏–µ-–ª–∏–±–æ 
–∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å–≤–æ—é –∫–æ–¥–æ–≤—É—é –±–∞–∑—É.

–í [–æ—Ç—á–µ—Ç–µ –æ –Ω–∞–≤—ã–∫–∞—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ HackerRank –∑–∞ 2019 –≥–æ–¥](https://research.hackerrank.com/developer-skills/2019#jobsearch3) 
_–ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ä–æ—Å—Ç –∏ –æ–±—É—á–µ–Ω–∏–µ_ –±—ã–ª–∏ –æ—Ç–º–µ—á–µ–Ω—ã –∫–∞–∫ –Ω–∞–∏–±–æ–ª–µ–µ –≤–∞–∂–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã 
–ø—Ä–∏ –ø–æ–∏—Å–∫–µ –Ω–æ–≤–æ–π —Ä–∞–±–æ—Ç—ã. –ö–∞–∫ –≤—ã –¥—É–º–∞–µ—Ç–µ, —Å–º–æ–∂–µ—Ç–µ –ª–∏ –≤—ã —á–µ–º—É-–Ω–∏–±—É–¥—å –Ω–∞—É—á–∏—Ç—å—Å—è –∏ 
—Ä–∞–∑–≤–∏–≤–∞—Ç—å—Å—è, —Ç–µ—Å—Ç–∏—Ä—É—è —Å–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ç–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º?

**–í—Å–µ —ç—Ç–æ –≤–µ–¥–µ—Ç –∫ —Ä–∞–∑–æ—á–∞—Ä–æ–≤–∞–Ω–∏—é –∏ –≤—ã–≥–æ—Ä–∞–Ω–∏—é.**

–ß—Ç–æ–±—ã –ª–µ–≥–∫–æ –∏ —É–≤–µ—Ä–µ–Ω–Ω–æ —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –≤–∞–º –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞–±–æ—Ä —Ç–µ—Å—Ç–æ–≤ 
–Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —É—Ä–æ–≤–Ω—è—Ö. –í —ç—Ç–æ–π —Å—Ç–∞—Ç—å–µ —è —Ä–∞—Å—Å–∫–∞–∂—É –Ω–∞ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–∏–º–µ—Ä–∞—Ö, 
–∫–∞–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö. –Ø —Ç–∞–∫–∂–µ 
—Ä–∞—Å—Å–∫–∞–∂—É –æ–± –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–µ—Ç–æ–¥–∞—Ö —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Go, —Ç–∞–∫–∏—Ö –∫–∞–∫ —Ç–µ—Å—Ç–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã,
assert —Ñ—É–Ω–∫—Ü–∏–∏, –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç–æ–¥–æ–º —á–µ—Ä–Ω–æ–≥–æ —è—â–∏–∫–∞.

–ß—Ç–æ –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ –æ–∑–Ω–∞—á–∞–µ—Ç –≤—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è?

## 4 –ø—Ä–∞–≤–∏–ª–∞ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

–Ø –ø–æ–¥–≥–æ—Ç–æ–≤–∏–ª 4 –ø—Ä–∞–≤–∏–ª–∞, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å, —á—Ç–æ–±—ã –≥–æ–≤–æ—Ä–∏—Ç—å –æ –≤—ã—Å–æ–∫–æ–º 
–∫–∞—á–µ—Å—Ç–≤–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤.

1. –ë—ã—Å—Ç—Ä–æ—Ç–∞

–•–æ—Ä–æ—à–∏–µ —Ç–µ—Å—Ç—ã **–¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –±—ã—Å—Ç—Ä—ã–º–∏. –ó–¥–µ—Å—å –Ω–µ—Ç –∫–æ–º–ø—Ä–æ–º–∏—Å—Å–æ–≤.**

–í—Å–µ –Ω–µ–Ω–∞–≤–∏–¥—è—Ç –¥–ª–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã. –î–∞–≤–∞–π—Ç–µ –ø–æ–¥—É–º–∞–µ–º –æ –≤—Ä–µ–º–µ–Ω–∏ –∏ –ø—Å–∏—Ö–∏—á–µ—Å–∫–æ–º 
–∑–¥–æ—Ä–æ–≤—å–µ –≤–∞—à–∏—Ö —Ç–æ–≤–∞—Ä–∏—â–µ–π –ø–æ –∫–æ–º–∞–Ω–¥–µ, –∫–æ–≥–¥–∞ –æ–Ω–∏ –∂–¥—É—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ç–µ—Å—Ç–æ–≤. –ò –≤ 
CI, –∏ –ª–æ–∫–∞–ª—å–Ω–æ. –≠—Ç–æ —É–∂–∞—Å–Ω–æ.

–ö–æ–≥–¥–∞ –≤—ã –∂–¥–µ—Ç–µ –¥–æ–ª–≥–æ–µ –≤—Ä–µ–º—è, –≤—ã, –≤–µ—Ä–æ—è—Ç–Ω–æ, —Ç–µ–º –≤—Ä–µ–º–µ–Ω–µ–º –Ω–∞—á–Ω–µ—Ç–µ –¥–µ–ª–∞—Ç—å 
—á—Ç–æ-–Ω–∏–±—É–¥—å –µ—â–µ. –ü–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ CI –∑–∞–∫–æ–Ω—á–∏—Ç—Å—è (–Ω–∞–¥–µ—é—Å—å), –≤–∞–º –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –≤–µ—Ä–Ω—É—Ç—å—Å—è
–∫ —ç—Ç–æ–π –∑–∞–¥–∞—á–µ. –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ ‚Äî –æ–¥–∏–Ω –∏–∑ —Å–∞–º—ã—Ö —Å–µ—Ä—å–µ–∑–Ω—ã—Ö —É–±–∏–π—Ü 
–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏. –≠—Ç–æ –æ—á–µ–Ω—å —É—Ç–æ–º–ª—è–µ—Ç –Ω–∞—à –º–æ–∑–≥. –ú—ã –Ω–µ —Ä–æ–±–æ—Ç—ã.

–Ø –∑–Ω–∞—é, —á—Ç–æ –µ—Å—Ç—å –µ—â–µ –∫–æ–º–ø–∞–Ω–∏–∏, –≥–¥–µ —Ç–µ—Å—Ç—ã –º–æ–≥—É—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è 24 —á–∞—Å–∞ –≤ —Å—É—Ç–∫–∏. 
–ú—ã –Ω–µ —Ö–æ—Ç–∏–º —Å–ª–µ–¥–æ–≤–∞—Ç—å —ç—Ç–æ–º—É –ø–æ–¥—Ö–æ–¥—É. üòâ

–í—ã –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω—è—Ç—å —Ç–µ—Å—Ç—ã –ª–æ–∫–∞–ª—å–Ω–æ –º–µ–Ω–µ–µ —á–µ–º –∑–∞ 1 –º–∏–Ω—É—Ç—É, –≤ 
–∏–¥–µ–∞–ª–µ **–º–µ–Ω–µ–µ —á–µ–º –∑–∞ 10 —Å–µ–∫—É–Ω–¥**. –Ø –∑–Ω–∞—é, —á—Ç–æ –∏–Ω–æ–≥–¥–∞ –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ 
–≤—Ä–µ–º—è. –≠—Ç–æ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—è —Å –æ—Ç–ª–∏—á–Ω—ã–º ROI (_–≤–æ–∑–≤—Ä–∞—Ç–æ–º –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π_)! –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ –≤—ã 
–º–æ–∂–µ—Ç–µ –æ—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–≤–æ–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è. –ö—Ä–æ–º–µ —Ç–æ–≥–æ, –≤—Ä–µ–º—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –∏ 
—Ç. –¥. –Ω–∞–º–Ω–æ–≥–æ –∫–æ—Ä–æ—á–µ.

–ü–æ –º–æ–µ–º—É –æ–ø—ã—Ç—É, –≤—Å–µ–≥–¥–∞ —Å—Ç–æ–∏—Ç –ø—ã—Ç–∞—Ç—å—Å—è –Ω–∞–π—Ç–∏ –±—ã—Å—Ç—Ä—ã–µ —Ä–µ—à–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç 
–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —Å–æ–∫—Ä–∞—Ç–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤. –ó–¥–µ—Å—å –æ—Ç–ª–∏—á–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç [–ø—Ä–∏–Ω—Ü–∏–ø –ü–∞—Ä–µ—Ç–æ 
(–ø—Ä–∞–≤–∏–ª–æ 80/20)](https://en.wikipedia.org/wiki/Pareto_principle)!

2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–∏—Ç—É–∞—Ü–∏–π –Ω–∞ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω—è—Ö.

–Ø –Ω–∞–¥–µ—é—Å—å, —á—Ç–æ –≤—ã —É–∂–µ –∑–Ω–∞–µ—Ç–µ, —á—Ç–æ 100% —Ç–µ—Å—Ç–æ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ - –Ω–µ –ª—É—á—à–∞—è –∏–¥–µ—è 
(–µ—Å–ª–∏ —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–∞—è/–≤–∞–∂–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞).

–í—Å–µ–≥–¥–∞ –ø–æ–ª–µ–∑–Ω–æ –∑–∞–¥–∞—Ç—å —Å–µ–±–µ –≤–æ–ø—Ä–æ—Å _¬´–Ω–∞—Å–∫–æ–ª—å–∫–æ –ª–µ–≥–∫–æ —ç—Ç–æ –º–æ–∂–µ—Ç —Å–ª–æ–º–∞—Ç—å—Å—è?¬ª_. –ï—â—ë 
–±–æ–ª–µ–µ —Ü–µ–ª–µ—Å–æ–æ–±—Ä–∞–∑–Ω–æ –∑–∞–¥–∞—Ç—å —ç—Ç–æ—Ç –≤–æ–ø—Ä–æ—Å, –µ—Å–ª–∏ –≤—ã —á—É–≤—Å—Ç–≤—É–µ—Ç–µ, —á—Ç–æ –≤—ã–ø–æ–ª–Ω—è–µ–º—ã–π —Ç–µ—Å—Ç 
–Ω–∞—á–∏–Ω–∞–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å —Ç–æ—á–Ω–æ —Ç–∞–∫ –∂–µ, –∫–∞–∫ —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä—É—é –≤—ã —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç–µ. –í –∫–æ–Ω—Ü–µ
–∫–æ–Ω—Ü–æ–≤ –º—ã –Ω–µ –ø–∏—à–µ–º —Ç–µ—Å—Ç—ã, –ø–æ—Ç–æ–º—É —á—Ç–æ —Ç–µ—Å—Ç—ã —Ö–æ—Ä–æ—à–∏, –Ω–æ –æ–Ω–∏ –¥–æ–ª–∂–Ω—ã –ø—Ä–∏–∫—Ä—ã–≤–∞—Ç—å –Ω–∞—Å 
–æ—Ç –Ω–µ–ø—Ä–∏—è—Ç–Ω–æ—Å—Ç–µ–π!

–ü–æ –º–æ–µ–º—É –æ–ø—ã—Ç—É, **–ø–æ–∫—Ä—ã—Ç–∏–µ –≤ 70-80% - –Ω–µ–ø–ª–æ—Ö–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ Go.**

–¢–∞–∫–∂–µ –Ω–µ –ª—É—á—à–∞—è –∏–¥–µ—è –ø–æ–∫—Ä—ã–≤–∞—Ç—å –≤—Å–µ —Å –ø–æ–º–æ—â—å—é –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω—ã—Ö –∏–ª–∏ —Å–∫–≤–æ–∑–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤. 
–í–æ-–ø–µ—Ä–≤—ã—Ö, –≤—ã –Ω–µ —Å–º–æ–∂–µ—Ç–µ —ç—Ç–æ–≥–æ —Å–¥–µ–ª–∞—Ç—å –∏–∑-–∑–∞ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Å–º–æ–¥–µ–ª–∏—Ä–æ–≤–∞—Ç—å 
–Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Å–ª—É—á–∞–∏ –æ—à–∏–±–æ–∫, –Ω–∞–ø—Ä–∏–º–µ—Ä, –æ—Ç–∫–∞—Ç—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏. –í–æ-–≤—Ç–æ—Ä—ã—Ö, 
—ç—Ç–æ –Ω–∞—Ä—É—à–∏—Ç –ø–µ—Ä–≤–æ–µ –ø—Ä–∞–≤–∏–ª–æ. –≠—Ç–∏ —Ç–µ—Å—Ç—ã –±—É–¥—É—Ç –º–µ–¥–ª–µ–Ω–Ω—ã–º–∏.

![component](images/part8/testing-app.svg)

![e2e](images/part8/testing-e2e.svg)

–¢–µ—Å—Ç—ã –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —É—Ä–æ–≤–Ω—è—Ö —Ç–∞–∫–∂–µ –¥–æ–ª–∂–Ω—ã –ø–µ—Ä–µ–∫—Ä—ã–≤–∞—Ç—å—Å—è, —á—Ç–æ–±—ã –º—ã –∑–Ω–∞–ª–∏, —á—Ç–æ 
–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ.

–í–∞–º –º–æ–∂–µ—Ç –ø–æ–∫–∞–∑–∞—Ç—å—Å—è, —á—Ç–æ —Ä–µ—à–∏—Ç—å —ç—Ç—É –ø—Ä–æ–±–ª–µ–º—É –ø—Ä–æ—Å—Ç–æ: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é 
–ø–∏—Ä–∞–º–∏–¥—É! –ò —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ç–∞–∫... –∏–Ω–æ–≥–¥–∞. –û—Å–æ–±–µ–Ω–Ω–æ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö, –∫–æ—Ç–æ—Ä—ã–µ
–≤—ã–ø–æ–ª–Ω—è—é—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ –æ–ø–µ—Ä–∞—Ü–∏–π –∑–∞–ø–∏—Å–∏.

![pyramid](images/part8/testing-pyramid.svg)

–ù–æ –∫–∞–∫ –±—ã—Ç—å, –Ω–∞–ø—Ä–∏–º–µ—Ä, —Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏, –∫–æ—Ç–æ—Ä—ã–µ —Å–æ–±–∏—Ä–∞—é—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö 
–¥—Ä—É–≥–∏—Ö —Å–ª—É–∂–± –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—Ç –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ API? –í –Ω–µ–º –Ω–µ—Ç —Å–ª–æ–∂–Ω–æ–π –ª–æ–≥–∏–∫–∏ 
—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö. –í–µ—Ä–æ—è—Ç–Ω–æ, –±–æ–ª—å—à–∞—è —á–∞—Å—Ç—å –∫–æ–¥–∞ —Å–≤—è–∑–∞–Ω–∞ —Å –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏ —Å –±–∞–∑–æ–π 
–¥–∞–Ω–Ω—ã—Ö. –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ —Å–ª–µ–¥—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **–ø–µ—Ä–µ–≤–µ—Ä–Ω—É—Ç—É—é —Ç–µ—Å—Ç–æ–≤—É—é –ø–∏—Ä–∞–º–∏–¥—É** 
(–æ–Ω–∞ –±–æ–ª—å—à–µ –ø–æ—Ö–æ–∂–∞ –Ω–∞ –µ–ª–∫—É). –ö–æ–≥–¥–∞ –±–æ–ª—å—à–∞—è —á–∞—Å—Ç—å –Ω–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∞ –∫ 
–∫–∞–∫–æ–π-–ª–∏–±–æ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö), –ø—Ä–æ—Å—Ç–æ —Å–ª–æ–∂–Ω–æ –ø–æ–∫—Ä—ã—Ç—å 
–º–Ω–æ–≥–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å –ø–æ–º–æ—â—å—é unit —Ç–µ—Å—Ç–æ–≤.

![reverse-pyramid](images/part8/reversed-testing-pyramid.svg)

3. –¢–µ—Å—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –Ω–∞–¥–µ–∂–Ω—ã–º–∏ –∏ –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏.

–ó–Ω–∞–µ—Ç–µ –ª–∏ –≤—ã —ç—Ç–æ —á—É–≤—Å—Ç–≤–æ, –∫–æ–≥–¥–∞ –≤—ã –¥–µ–ª–∞–µ—Ç–µ –∫–∞–∫–æ–µ-—Ç–æ —Å—Ä–æ—á–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ, —Ç–µ—Å—Ç—ã 
–ø—Ä–æ—Ö–æ–¥—è—Ç –ª–æ–∫–∞–ª—å–Ω–æ, –≤—ã –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏... —á–µ—Ä–µ–∑ 20 –º–∏–Ω—É—Ç 
–æ–Ω–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç –≤ CI? –≠—Ç–æ –Ω–µ–≤–µ—Ä–æ—è—Ç–Ω–æ —Ä–∞—Å—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç. –≠—Ç–æ —Ç–∞–∫–∂–µ –æ—Ç–±–∏–≤–∞—Ç—å –æ—Ö–æ—Ç—É —É –Ω–∞—Å 
–¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ç–µ—Å—Ç—ã. –≠—Ç–æ —Ç–∞–∫–∂–µ —Å–Ω–∏–∂–∞–µ—Ç –Ω–∞—à–µ –¥–æ–≤–µ—Ä–∏–µ –∫ –Ω–∏–º.

–í—ã –¥–æ–ª–∂–Ω—ã –∏—Å–ø—Ä–∞–≤–∏—Ç—å —ç—Ç—É –ø—Ä–æ–±–ª–µ–º—É –∫–∞–∫ –º–æ–∂–Ω–æ –±—ã—Å—Ç—Ä–µ–µ. –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ [—Ç–µ–æ—Ä–∏—è 
—Ä–∞–∑–±–∏—Ç—ã—Ö –æ–∫–æ–Ω](https://en.wikipedia.org/wiki/Broken_windows_theory) –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –≤–µ—Ä–Ω–∞.

4. –í—ã –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω—è—Ç—å –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —Ç–µ—Å—Ç–æ–≤ –ª–æ–∫–∞–ª—å–Ω–æ.

–¢–µ—Å—Ç—ã, –∑–∞–ø—É—Å–∫–∞–µ–º—ã–µ –ª–æ–∫–∞–ª—å–Ω–æ, –¥–æ–ª–∂–Ω—ã –¥–∞—Ç—å –≤–∞–º –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –≤ —Ç–æ–º, 
—á—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä—É—é –≤—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–ª–∏ –∏–ª–∏ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–ª–∏, –≤—Å–µ –µ—â–µ —Ä–∞–±–æ—Ç–∞–µ—Ç. 
**E2E-—Ç–µ—Å—Ç—ã –¥–æ–ª–∂–Ω—ã –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –≤—Å–µ –ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ.**

–£ –≤–∞—Å —Ç–∞–∫–∂–µ –±—É–¥–µ—Ç –≥–æ—Ä–∞–∑–¥–æ –±–æ–ª—å—à–µ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏, –∫–æ–≥–¥–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏ 
–±—É–¥—É—Ç [–Ω–∞–¥–µ–∂–Ω—ã–º–∏ –∏–∑-–∑–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è gRPC](https://threedots.tech/post/robust-grpc-google-cloud-run/), protobuf –∏–ª–∏ OpenAPI.

–≠—Ç–æ —Ö–æ—Ä–æ—à–∞—è –ø—Ä–∏—á–∏–Ω–∞ –ø–æ–∫—Ä—ã—Ç—å —Ç–µ—Å—Ç–∞–º–∏ –∫–∞–∫ –º–æ–∂–Ω–æ –±–æ–ª—å—à–µ –Ω–∞ –±–æ–ª–µ–µ –Ω–∏–∑–∫–∏—Ö —É—Ä–æ–≤–Ω—è—Ö 
(–Ω–∞—á–∏–Ω–∞—è —Å —Å–∞–º–æ–≥–æ –Ω–∏–∑–∫–æ–≥–æ): unit, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–º –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω–æ–º. 
–¢–æ–ª—å–∫–æ —Ç–æ–≥–¥–∞ E2E.

## –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

–£ –Ω–∞—Å –µ—Å—Ç—å –æ–±—â–∞—è —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∞—è –±–∞–∑–∞. –ù–æ –Ω–∞–º –Ω–∏–∫—Ç–æ –Ω–µ –ø–ª–∞—Ç–∏—Ç –∑–∞ —Ç–æ, —á—Ç–æ –º—ã 
—è–≤–ª—è–µ–º—Å—è –∑–Ω–∞—Ç–æ–∫–∞–º–∏ —Ç–µ–æ—Ä–∏–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è. –î–∞–≤–∞–π—Ç–µ —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –Ω–µ—Å–∫–æ–ª—å–∫–æ 
–ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–∏–º–µ—Ä–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã –º–æ–∂–µ—Ç–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤ —Å–≤–æ–µ–º –ø—Ä–æ–µ–∫—Ç–µ.

–ù–∞—á–Ω–µ–º —Å —à–∞–±–ª–æ–Ω–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π, –∫–æ—Ç–æ—Ä—ã–π —è –æ–ø–∏—Å–∞–ª –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–π —Å—Ç–∞—Ç—å–µ. –í–∞–º –Ω–µ 
–Ω—É–∂–Ω–æ —á–∏—Ç–∞—Ç—å –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–∞—Ç—å–∏ –∏–∑ —ç—Ç–æ–π —Å–µ—Ä–∏–∏, –Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ö–æ—Ç—è 
–±—ã [–ø—Ä–µ–¥—ã–¥—É—â—É—é](https://threedots.tech/post/repository-pattern-in-go/). –í–∞–º –±—É–¥–µ—Ç
–Ω–∞–º–Ω–æ–≥–æ –ø–æ–Ω—è—Ç–Ω–µ–µ –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞—à–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è.

> –≠—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ –æ—á–µ—Ä–µ–¥–Ω–∞—è —Å—Ç–∞—Ç—å—è —Å–æ —Å–ª—É—á–∞–π–Ω—ã–º–∏ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞–º–∏ –∫–æ–¥–∞.
> 
> –≠—Ç–æ—Ç –ø–æ—Å—Ç —è–≤–ª—è–µ—Ç—Å—è —á–∞—Å—Ç—å—é –±–æ–ª—å—à–æ–≥–æ —Ü–∏–∫–ª–∞, –ø–æ–∫–∞–∑—ã–≤–∞—é—â–∏–π –∫–∞–∫ —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞
> **Go, –∫–æ—Ç–æ—Ä—ã–µ –ª–µ–≥–∫–æ —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –∏ —Å –Ω–∏–º–∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –≤
> –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–π –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–µ**. –ú—ã –¥–µ–ª–∞–µ–º —ç—Ç–æ, –¥–µ–ª—è—Å—å –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–º–∏ –º–µ—Ç–æ–¥–∞–º–∏, –æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–º–∏
> –Ω–∞ –º–Ω–æ–≥–∏—Ö —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞—Ö, –ø—Ä–æ–≤–µ–¥—ë–Ω–Ω—ã–º–∏ —Å –≤–æ–∑–≥–ª–∞–≤–ª—è–µ–º—ã–º–∏ –Ω–∞–º–∏ —Å –∫–æ–º–∞–Ω–¥–∞–º–∏,
> –∏ [–Ω–∞—É—á–Ω—ã—Ö –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è—Ö](https://threedots.tech/post/ddd-lite-in-go-introduction/#thats-great-but-do-you-have-any-evidence-it-works).
> –í—ã –º–æ–∂–µ—Ç–µ –∏–∑—É—á–∏—Ç—å —ç—Ç–∏ –º–µ—Ç–æ–¥—ã, —Å–æ–∑–¥–∞–≤ —Å –Ω–∞–º–∏ [–ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π](https://threedots.tech/post/serverless-cloud-run-firebase-modern-go-application/#what-wild-workouts-can-do) –ø—Ä–∏–º–µ—Ä
> –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ Go - **Wild Workouts**.
> 
> –ú—ã –ø–æ—Å—Ç—É–ø–∏–ª–∏ –Ω–µ —Å–æ–≤—Å–µ–º –æ–±—ã—á–Ω–æ ‚Äî **–¥–æ–±–∞–≤–∏–ª–∏ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –Ω–µ —Å—Ä–∞–∑—É –∑–∞–º–µ—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
> –≤ –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é Wild Workouts**. –ù–µ—É–∂–µ–ª–∏ –º—ã —Å–æ—à–ª–∏ —Å —É–º–∞? –ü–æ–∫–∞ –Ω–µ—Ç. üòâ
> –≠—Ç–∏ –ø—Ä–æ–±–ª–µ–º—ã —Ö–∞—Ä–∞–∫—Ç–µ—Ä–Ω—ã –¥–ª—è –º–Ω–æ–≥–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ Go. **–í –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–π –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–µ —ç—Ç–∏
> –Ω–µ–±–æ–ª—å—à–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –∫—Ä–∏—Ç–∏—á–Ω—ã–º–∏ –∏ –Ω–µ –ø–æ–∑–≤–æ–ª—è—é—Ç –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª.**
>
> **–≠—Ç–æ –æ–¥–∏–Ω –∏–∑ –≤–∞–∂–Ω–µ–π—à–∏—Ö –Ω–∞–≤—ã–∫–æ–≤ —Å—Ç–∞—Ä—à–µ–≥–æ –∏–ª–∏ –≤–µ–¥—É—â–µ–≥–æ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞; –≤—Å–µ–≥–¥–∞ –Ω—É–∂–Ω–æ
> –ø–æ–º–Ω–∏—Ç—å –æ –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã—Ö –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è—Ö.**
>
> –ú—ã –∏—Å–ø—Ä–∞–≤–∏–º –∏—Ö –ø—É—Ç–µ–º **—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞** Wild Workouts. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –≤—ã –±—ã—Å—Ç—Ä–æ –ø–æ–π–º—ë—Ç–µ
> –º–µ—Ç–æ–¥–∏–∫–∏, –∫–æ—Ç–æ—Ä—ã–º–∏ –º—ã –¥–µ–ª–∏–º—Å—è.
> –ó–Ω–∞–µ—Ç–µ –ª–∏ –≤—ã —ç—Ç–æ —á—É–≤—Å—Ç–≤–æ, –∫–æ–≥–¥–∞ –ø—Ä–æ—á–∏—Ç–∞–ª–∏ —Å—Ç–∞—Ç—å—é –æ –∫–∞–∫–æ–π-—Ç–æ –º–µ—Ç–æ–¥–∏–∫–µ –∏ –ø–æ–ø—ã—Ç–∞–ª–∏—Å—å
> —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –µ—ë, –Ω–æ –Ω–µ —Å–º–æ–≥–ª–∏ –∏–∑-–∑–∞ —É–ø—É—â–µ–Ω–∏–π –∏ –ø—Ä–æ–ø—É—Å–∫–∞ –¥–µ—Ç–∞–ª–µ–π –≤ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–µ.
> –ü—Ä–æ–ø—É—Å–∫ –¥–µ—Ç–∞–ª–µ–π –¥–µ–ª–∞–µ—Ç —Å—Ç–∞—Ç—å–∏ –∫–æ—Ä–æ—á–µ –∏ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –ø—Ä–æ—Å–º–æ—Ç—Ä—ã —Å—Ç—Ä–∞–Ω–∏—Ü, –Ω–æ —ç—Ç–æ
> –Ω–µ –Ω–∞—à–∞ —Ü–µ–ª—å. –ù–∞—à–∞ —Ü–µ–ª—å ‚Äî —Å–æ–∑–¥–∞—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª, –∫–æ—Ç–æ—Ä—ã–π –¥–∞—Å—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–Ω–∞–Ω–∏–π –¥–ª—è
> –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö –º–µ—Ç–æ–¥–∏–∫. –ï—Å–ª–∏ –≤—ã –µ—â–µ –Ω–µ —á–∏—Ç–∞–ª–∏ [–ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Å—Ç–∞—Ç—å–∏ –∏–∑
> —ç—Ç–æ–≥–æ —Ü–∏–∫–ª–∞](https://threedots.tech/series/modern-business-software-in-go/),
> –º—ã –Ω–∞—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º —ç—Ç–æ —Å–¥–µ–ª–∞—Ç—å.
>
> –ú—ã —Å—á–∏—Ç–∞–µ–º, —á—Ç–æ –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –æ–±–ª–∞—Å—Ç—è—Ö –∑–Ω–∞–Ω–∏–π –Ω–µ–ª—å–∑—è –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å –¥–µ—Ç–∞–ª–∏. –ï—Å–ª–∏ –≤—ã
> —Ö–æ—Ç–∏—Ç–µ –±—ã—Å—Ç—Ä–æ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –≤–∞–º –Ω—É–∂–Ω–æ –ø–æ—Ç—Ä–∞—Ç–∏—Ç—å
> –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å –∫–∞–∫ —ç—Ç–æ —Å–¥–µ–ª–∞—Ç—å. –ï—Å–ª–∏ –±—ã –≤—Å—ë –±—ã–ª–æ —Ç–∞–∫ –ø—Ä–æ—Å—Ç–æ,
> —É –Ω–∞—Å –±—ã –Ω–µ –±—ã–ª–æ —Ç–∞–∫–æ–≥–æ –±–æ–ª—å—à–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —É—Å—Ç—Ä–∞—à–∞—é—â–µ–≥–æ —É—Å—Ç–∞—Ä–µ–≤—à–µ–≥–æ –∫–æ–¥–∞.
> 
> –í–æ—Ç [–ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∏–∑ 14 –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã—Ö –Ω–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç —Å—Ç–∞—Ç–µ–π](https://threedots.tech/series/modern-business-software-in-go/).
>
> –í–µ—Å—å –∫–æ–¥ Wild Workouts –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ [GitHub](https://github.com/ThreeDotsLabs/wild-workouts-go-ddd-example). –ù–µ –∑–∞–±—É–¥—å—Ç–µ –ø–æ—Å—Ç–∞–≤–∏—Ç—å –∑–≤–µ–∑–¥—É
> –Ω–∞—à–µ–º—É –ø—Ä–æ–µ–∫—Ç—É! ‚≠ê

–°–ø–æ—Å–æ–± –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –Ω–∞—à–µ–π –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º 
`hour.Repository`. –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è, —á—Ç–æ –Ω–∞—à–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –ø—Ä–æ—Å—Ç–∞. –í—Å—è 
—Å–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–µ–¥–º–µ—Ç–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏ –Ω–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. **–û–Ω–∞
–¥–æ–ª–∂–Ω–∞ –ø—Ä–æ—Å—Ç–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –¥–∞–Ω–Ω—ã–µ –±–µ–∑ –∫–∞–∫–∏—Ö-–ª–∏–±–æ –ø—Ä–æ–≤–µ—Ä–æ–∫ –∏ —Ç. –¥. –û–¥–Ω–∏–º –∏–∑ 
—Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤ —Ç–∞–∫–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞ —è–≤–ª—è–µ—Ç—Å—è —É–ø—Ä–æ—â–µ–Ω–∏–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ 
—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –∏ —Ç–µ—Å—Ç–æ–≤.**

–í –ø—Ä–µ–¥—ã–¥—É—â–µ–π —Å—Ç–∞—Ç—å–µ —è –ø–æ–¥–≥–æ—Ç–æ–≤–∏–ª —Ç—Ä–∏ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö: MySQL, 
Firebase –∏ –≤ –ø–∞–º—è—Ç–∏. –ú—ã –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–µ–º –∏—Ö –≤—Å–µ. –í—Å–µ –æ–Ω–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≤–º–µ—Å—Ç–∏–º—ã, –ø–æ—ç—Ç–æ–º—É 
—É –Ω–∞—Å –±—É–¥–µ—Ç —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –Ω–∞–±–æ—Ä —Ç–µ—Å—Ç–æ–≤.

```go
package hour

type Repository interface {
    GetOrCreateHour(ctx context.Context, hourTime time.Time) (*Hour, error)
    UpdateHour(
        ctx context.Context,
        hourTime time.Time,
        updateFn func(h *Hour) (*Hour, error),
    ) error
}
```
–í–µ—Å—å –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥: [github.com/ThreeDotsLabs/wild-workouts-go-ddd-example/internal/trainer/domain/hour/repository.go](https://github.com/ThreeDotsLabs/wild-workouts-go-ddd-example/blob/521fdb5d6aa4f1f7ff18ec33f50ce6710906d73b/internal/trainer/domain/hour/repository.go#L8)

–ò–∑-–∑–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ –≤ –Ω–∞—à–∏—Ö —Ç–µ—Å—Ç–∞—Ö –º—ã –ø–µ—Ä–µ–±–∏—Ä–∞–µ–º –∏—Ö –≤ 
—Å–ø–∏—Å–∫–µ.

> –≠—Ç–æ –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ –æ—á–µ–Ω—å –ø–æ—Ö–æ–¥–µ –Ω–∞ —Ç–æ, –∫–∞–∫ –º—ã –ø—Ä–æ–≤–æ–¥–∏–ª–∏ [—Ç–µ—Å—Ç—ã –≤ Watermill](https://github.com/ThreeDotsLabs/watermill/blob/master/pubsub/tests/test_pubsub.go).
> 
> –í—Å–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ò–∑–¥–∞—Ç–µ–ª—è/–ü–æ–¥–ø–∏—Å—á–∏–∫–∞ –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –Ω–∞–±–æ—Ä —Ç–µ—Å—Ç–æ–≤.

–í—Å–µ —Ç–µ—Å—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –º—ã –Ω–∞–ø–∏—à–µ–º, –±—É–¥—É—Ç —Ç–µ—Å—Ç–∞–º–∏ —á–µ—Ä–Ω–æ–≥–æ —è—â–∏–∫–∞. –î—Ä—É–≥–∏–º–∏ —Å–ª–æ–≤–∞–º–∏ ‚Äî 
–º—ã –±—É–¥–µ–º –ø–æ–∫—Ä—ã–≤–∞—Ç—å —Ç–µ—Å—Ç–∞–º–∏ —Ç–æ–ª—å–∫–æ –ø—É–±–ª–∏—á–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏. –ß—Ç–æ–±—ã –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–æ, 
–≤—Å–µ –Ω–∞—à–∏ —Ç–µ—Å—Ç–æ–≤—ã–µ –ø–∞–∫–µ—Ç—ã –∏–º–µ—é—Ç —Å—É—Ñ—Ñ–∏–∫—Å `_test`. –≠—Ç–æ –∑–∞—Å—Ç–∞–≤–ª—è–µ—Ç –Ω–∞—Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å 
—Ç–æ–ª—å–∫–æ –ø—É–±–ª–∏—á–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–∞–∫–µ—Ç–∞. **–í –±—É–¥—É—â–µ–º —ç—Ç–æ –æ–∫—É–ø–∏—Ç—Å—è –≥–æ—Ä–∞–∑–¥–æ –±–æ–ª–µ–µ —Å—Ç–∞–±–∏–ª—å–Ω—ã–º–∏ 
—Ç–µ—Å—Ç–∞–º–∏, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –≤–ª–∏—è—é—Ç –Ω–∏–∫–∞–∫–∏–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è.** –ï—Å–ª–∏ –≤—ã –Ω–µ –º–æ–∂–µ—Ç–µ 
–Ω–∞–ø–∏—Å–∞—Ç—å —Ö–æ—Ä–æ—à–∏–µ —Ç–µ—Å—Ç—ã —á–µ—Ä–Ω–æ–≥–æ —è—â–∏–∫–∞, –≤–∞–º —Å–ª–µ–¥—É–µ—Ç –ø–æ–¥—É–º–∞—Ç—å –æ —Ç–æ–º, —Ö–æ—Ä–æ—à–æ –ª–∏ 
—Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤–∞—à–∏ –æ–±—â–µ–¥–æ—Å—Ç—É–ø–Ω—ã–µ API.

–í—Å–µ —Ç–µ—Å—Ç—ã –Ω–∞—à–µ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ. –ë–ª–∞–≥–æ–¥–∞—Ä—è —ç—Ç–æ–º—É –æ–Ω–∏ –æ—Ç—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –º–µ–Ω–µ–µ 
—á–µ–º –∑–∞ `200 –º—Å`. –ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å–ª—É—á–∞–µ–≤ —ç—Ç–æ –≤—Ä–µ–º—è –Ω–µ –¥–æ–ª–∂–Ω–æ 
–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–≤–µ–ª–∏—á–∏–≤–∞—Ç—å—Å—è.

```go
package main_test

func TestRepository(t *testing.T) {
    rand.Seed(time.Now().UTC().UnixNano())
    
    repositories := createRepositories(t)
    
    for i := range repositories {
        // –ö–æ–≥–¥–∞ –≤—ã –ø–µ—Ä–µ–±–∏—Ä–∞–µ—Ç–µ —Å—Ä–µ–∑ –∏ –ø–æ–∑–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –ø–æ–≤—Ç–æ—Ä—è—é—â–µ–µ—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ –≤ goroutine (–∑–¥–µ—Å—å –∏–∑-–∑–∞ t.Parallel ()),
        // –≤–∞–º –Ω—É–∂–Ω–æ –≤—Å–µ–≥–¥–∞ —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –≤ —Ç–µ–ª–µ —Ü–∏–∫–ª–∞!
        // –ü–æ–¥—Ä–æ–±–Ω–µ–µ –∑–¥–µ—Å—å: https://github.com/golang/go/wiki/CommonMistakes#using-goroutines-on-loop-iterator-variables
        r := repositories[i]
    
        t.Run(r.Name, func(t *testing.T) {
            // –í—Å–µ–≥–¥–∞ –ø–æ–ª–µ–∑–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –≤—Å–µ –Ω–µ unit —Ç–µ—Å—Ç—ã, —á—Ç–æ–±—ã –æ–Ω–∏ –º–æ–≥–ª–∏ —Ä–∞–±–æ—Ç–∞—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ.
            // –ë–ª–∞–≥–æ–¥–∞—Ä—è —ç—Ç–æ–º—É –≤–∞—à–∏ —Ç–µ—Å—Ç—ã –≤—Å–µ–≥–¥–∞ –±—É–¥—É—Ç –±—ã—Å—Ç—Ä–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è, –∏ –≤—ã –Ω–µ –±—É–¥–µ—Ç–µ –±–æ—è—Ç—å—Å—è –¥–æ–±–∞–≤–ª—è—Ç—å —Ç–µ—Å—Ç—ã –∏–∑-–∑–∞ –∑–∞–º–µ–¥–ª–µ–Ω–∏—è.
            t.Parallel()
    
            t.Run("testUpdateHour", func(t *testing.T) {
                t.Parallel()
                testUpdateHour(t, r.Repository)
            })
            t.Run("testUpdateHour_parallel", func(t *testing.T) {
                t.Parallel()
                testUpdateHour_parallel(t, r.Repository)
            })
            t.Run("testHourRepository_update_existing", func(t *testing.T) {
                t.Parallel()
                testHourRepository_update_existing(t, r.Repository)
            })
            t.Run("testUpdateHour_rollback", func(t *testing.T) {
                t.Parallel()
                testUpdateHour_rollback(t, r.Repository)
            })
        })
    }
}
```
–í–µ—Å—å –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥: [github.com/ThreeDotsLabs/wild-workouts-go-ddd-example/internal/trainer/hour_repository_test.go](https://github.com/ThreeDotsLabs/wild-workouts-go-ddd-example/blob/521fdb5d6aa4f1f7ff18ec33f50ce6710906d73b/internal/trainer/hour_repository_test.go#L19)

–ö–æ–≥–¥–∞ —É –Ω–∞—Å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–µ—Å—Ç–æ–≤, –≥–¥–µ –º—ã –ø–µ—Ä–µ–¥–∞—ë–º –æ–¥–∏–Ω –∏ —Ç–µ –∂–µ –≤—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ 
–ø—Ä–æ–≤–µ—Ä—è–µ–º –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –æ—Ç–≤–µ—Ç, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥, –∏–∑–≤–µ—Å—Ç–Ω—ã–π –∫–∞–∫ 
_—Ç–µ—Å—Ç–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞_. –ò–¥–µ—è –ø—Ä–æ—Å—Ç–∞: –≤—ã –¥–æ–ª–∂–Ω—ã –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –Ω–∞–±–æ—Ä –≤—Ö–æ–¥–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ 
–∏ –æ–∂–∏–¥–∞–µ–º—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ç–µ—Å—Ç–∞ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∏—Ç–µ—Ä–∞—Ü–∏—é –ø–æ –Ω–µ–π –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤.

```go
func testUpdateHour(t *testing.T, repository hour.Repository) {
    t.Helper()
    ctx := context.Background()
    
    testCases := []struct {
        Name       string
        CreateHour func(*testing.T) *hour.Hour
    }{
        {
            Name: "available_hour",
            CreateHour: func(t *testing.T) *hour.Hour {
                return newValidAvailableHour(t)
            },
        },
        {
            Name: "not_available_hour",
            CreateHour: func(t *testing.T) *hour.Hour {
                h := newValidAvailableHour(t)
                require.NoError(t, h.MakeNotAvailable())
    
                return h
            },
        },
        {
            Name: "hour_with_training",
            CreateHour: func(t *testing.T) *hour.Hour {
                h := newValidAvailableHour(t)
                require.NoError(t, h.ScheduleTraining())
    
                return h
            },
        },
    }
    
    for _, tc := range testCases {
        t.Run(tc.Name, func(t *testing.T) {
            newHour := tc.CreateHour(t)
    
            err := repository.UpdateHour(ctx, newHour.Time(), func(_ *hour.Hour) (*hour.Hour, error) {
                // UpdateHour –≤—ã–¥–∞—ë—Ç –Ω–∞–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π/–Ω–æ–≤—ã–π *hour.Hour,
                // –Ω–æ –º—ã –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º —ç—Ç–æ—Ç —á–∞—Å –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç `CreateHour`
                // –º—ã –º–æ–∂–µ–º –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ —ç—Ç–æ–≥–æ —á–∞—Å–∞ –ø–æ–∑–¥–Ω–µ–µ –≤ assertHourInRepository
                return newHour, nil
            })
            require.NoError(t, err)
    
            assertHourInRepository(ctx, t, repository, newHour)
        })
    }
}
```
–í–µ—Å—å –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥: [github.com/ThreeDotsLabs/wild-workouts-go-ddd-example/internal/trainer/hour_repository_test.go](https://github.com/ThreeDotsLabs/wild-workouts-go-ddd-example/blob/521fdb5d6aa4f1f7ff18ec33f50ce6710906d73b/internal/trainer/hour_repository_test.go#L77)

–ö–∞–∫ –≤–∏–¥–∏—Ç–µ, –º—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –æ—á–µ–Ω—å –ø–æ–ø—É–ª—è—Ä–Ω—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É 
[github.com/stretchr/testify](https://github.com/stretchr/testify). –≠—Ç–æ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ 
—Å–æ–∫—Ä–∞—â–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä—è—é—â–µ–≥–æ—Å—è –∫–æ–¥–∞ –≤ —Ç–µ—Å—Ç–∞—Ö, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—è –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã—Ö
—Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è [asserts](https://godoc.org/github.com/stretchr/testify/assert).

> require.NoError()
> 
> –ö–æ–≥–¥–∞ assert.NoError –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è —Å –æ—à–∏–±–∫–æ–π, –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤ –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç—Å—è.
> 
> –°—Ç–æ–∏—Ç –æ—Ç–º–µ—Ç–∏—Ç—å, —á—Ç–æ asserts –∏–∑ –ø–∞–∫–µ—Ç–∞ `require` –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–µ—Å—Ç–∞ 
> –≤ —Å–ª—É—á–∞–µ –µ–≥–æ —Å–±–æ—è. –ü–æ —ç—Ç–æ–π –ø—Ä–∏—á–∏–Ω–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—à–∏–±–æ–∫ —á–∞—Å—Ç–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 
> –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—É `require`. –í–æ –º–Ω–æ–≥–∏—Ö —Å–ª—É—á–∞—è—Ö, –µ—Å–ª–∏ –∫–∞–∫–∞—è-—Ç–æ –æ–ø–µ—Ä–∞—Ü–∏—è 
> –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –Ω–µ—É–¥–∞—á–Ω–æ, –Ω–µ—Ç —Å–º—ã—Å–ª–∞ —á—Ç–æ-–ª–∏–±–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –¥–∞–ª—å—à–µ.
> 
> –ö–æ–≥–¥–∞ –º—ã –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–Ω–∞—á–µ–Ω–∏–π, assert - –ª—É—á—à–∏–π –≤—ã–±–æ—Ä, –ø–æ—Ç–æ–º—É —á—Ç–æ –≤—ã 
> –ø–æ–ª—É—á–∏—Ç–µ –±–æ–ª—å—à–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.

–ï—Å–ª–∏ —É –Ω–∞—Å –µ—Å—Ç—å –±–æ–ª–µ–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è assert, –≤—Å–µ–≥–¥–∞ –ø–æ–ª–µ–∑–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å 
–Ω–µ—Å–∫–æ–ª—å–∫–æ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π. –≠—Ç–æ —É—Å—Ç—Ä–∞–Ω—è–µ—Ç –±–æ–ª—å—à–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
–≤ –∫–æ–¥–µ –∏ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–ª—É—á—à–∞–µ—Ç —á–∏—Ç–∞–µ–º–æ—Å—Ç—å —Ç–µ—Å—Ç–æ–≤!

```go
func assertHourInRepository(ctx context.Context, t *testing.T, repo hour.Repository, hour *hour.Hour) {
    require.NotNil(t, hour)
    
    hourFromRepo, err := repo.GetOrCreateHour(ctx, hour.Time())
    require.NoError(t, err)
    
    assert.Equal(t, hour, hourFromRepo)
}
```
–í–µ—Å—å –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥: [github.com/ThreeDotsLabs/wild-workouts-go-ddd-example/internal/trainer/hour_repository_test.go](https://github.com/ThreeDotsLabs/wild-workouts-go-ddd-example/blob/521fdb5d6aa4f1f7ff18ec33f50ce6710906d73b/internal/trainer/hour_repository_test.go#L327)

## –¢–µ—Å—Ç–∏—Ä—É–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

–û—à–∏–±–∫–∏ –Ω–∞—É—á–∏–ª–∏ –º–µ–Ω—è, —á—Ç–æ —è –Ω–µ –¥–æ–ª–∂–µ–Ω –¥–æ–≤–µ—Ä—è—Ç—å —Å–µ–±–µ –ø—Ä–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–ª–æ–∂–Ω–æ–≥–æ 
–∫–æ–¥–∞. –ò–Ω–æ–≥–¥–∞ –º—ã –Ω–µ –º–æ–∂–µ–º –ø–æ–Ω—è—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –¥–æ–ø—É—Å—Ç–∏—Ç—å –∫–∞–∫—É—é-—Ç–æ 
–≥–ª—É–ø—É—é –æ—à–∏–±–∫—É. –í—ã –º–æ–∂–µ—Ç–µ –æ–±—Ä–µ—Å—Ç–∏ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –¥–≤—É–º—è —Å–ø–æ—Å–æ–±–∞–º–∏:

1. TDD - –¥–∞–≤–∞–π—Ç–µ –Ω–∞—á–Ω–µ–º —Å —Ç–µ—Å—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–≤–µ—Ä–∏—Ç, –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç 
   —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è.
2. –î–∞–≤–∞–π—Ç–µ –Ω–∞—á–Ω–µ–º —Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏, –∞ —Ç–µ—Å—Ç—ã –¥–æ–±–∞–≤–∏–º –ø–æ–∑–∂–µ.

```go
func testUpdateHour_rollback(t *testing.T, repository hour.Repository) {
    t.Helper()
    ctx := context.Background()
    
    hourTime := newValidHourTime()
    
    err := repository.UpdateHour(ctx, hourTime, func(h *hour.Hour) (*hour.Hour, error) {
        require.NoError(t, h.MakeAvailable())
        return h, nil
    })
    
    err = repository.UpdateHour(ctx, hourTime, func(h *hour.Hour) (*hour.Hour, error) {
        assert.True(t, h.IsAvailable())
        require.NoError(t, h.MakeNotAvailable())
    
        return h, errors.New("something went wrong")
    })
    require.Error(t, err)
    
    persistedHour, err := repository.GetOrCreateHour(ctx, hourTime)
    require.NoError(t, err)
    
    assert.True(t, persistedHour.IsAvailable(), "availability change was persisted, not rolled back")
}
```
–í–µ—Å—å –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥: [github.com/ThreeDotsLabs/wild-workouts-go-ddd-example/internal/trainer/hour_repository_test.go](https://github.com/ThreeDotsLabs/wild-workouts-go-ddd-example/blob/521fdb5d6aa4f1f7ff18ec33f50ce6710906d73b/internal/trainer/hour_repository_test.go#L197)

–ö–æ–≥–¥–∞ —è –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é TDD, —è —Å—Ç–∞—Ä–∞—é—Å—å –±—ã—Ç—å –ø–∞—Ä–∞–Ω–æ–∏–∫–æ–º, –µ—Å–ª–∏ —Ç–µ—Å—Ç–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤–µ—Ä–Ω–∞.

–î–ª—è –±–æ–ª—å—à–µ–π —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ —è –∏—Å–ø–æ–ª—å–∑—É—é –ø—Ä–∏–µ–º, –∫–æ—Ç–æ—Ä—ã–π —è –Ω–∞–∑—ã–≤–∞—é **—Ç–µ—Å—Ç–æ–≤—ã–º —Å–∞–±–æ—Ç–∞–∂–µ–º**.

**–ú–µ—Ç–æ–¥ –¥–æ–≤–æ–ª—å–Ω–æ –ø—Ä–æ—Å—Ç–æ–π ‚Äî –¥–∞–≤–∞–π—Ç–µ —Å–ª–æ–º–∞–µ–º —Ç–µ—Å—Ç–∏—Ä—É–µ–º—É—é –Ω–∞–º–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –∏ 
–ø–æ—Å–º–æ—Ç—Ä–∏–º, –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è –ª–∏ —Ç–µ—Å—Ç –Ω–µ—É–¥–∞—á–µ–π.**

```shell
func (m MySQLHourRepository) finishTransaction(err error, tx *sqlx.Tx) error {
-       if err != nil {
-               if rollbackErr := tx.Rollback(); rollbackErr != nil {
-                       return multierr.Combine(err, rollbackErr)
-               }
-
-               return err
-       } else {
-               if commitErr := tx.Commit(); commitErr != nil {
-                       return errors.Wrap(err, "failed to commit tx")
-               }
-
-               return nil
+       if commitErr := tx.Commit(); commitErr != nil {
+               return errors.Wrap(err, "failed to commit tx")
        }
+
+       return nil
}
```

–ï—Å–ª–∏ –ø–æ—Å–ª–µ —Ç–∞–∫–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–∞—à–∏ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥—É—Ç —É—Å–ø–µ—à–Ω–æ, —É –º–µ–Ω—è –ø–ª–æ—Ö–∏–µ –Ω–æ–≤–æ—Å—Ç–∏...

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å–ª–æ–≤–∏–π –≥–æ–Ω–∫–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

–ù–∞—à–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç –≤ –≤–∞–∫—É—É–º–µ. –í—Å–µ–≥–¥–∞ –º–æ–∂–µ—Ç —Å–ª—É—á–∏—Ç—å—Å—è —Ç–∞–∫, —á—Ç–æ 
–Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–ª–∏–µ–Ω—Ç–æ–≤ –º–æ–≥—É—Ç –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è –≤—ã–ø–æ–ª–Ω–∏—Ç—å –æ–¥–Ω—É –∏ —Ç—É –∂–µ –æ–ø–µ—Ä–∞—Ü–∏—é, –∏ —Ç–æ–ª—å–∫–æ 
–æ–¥–∏–Ω –ø–æ–±–µ–¥–∏—Ç!

–í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ —Ç–∏–ø–∏—á–Ω—ã–π —Å–ª—É—á–∞–π ‚Äî —ç—Ç–æ –∫–æ–≥–¥–∞ –¥–≤–∞ –∫–ª–∏–µ–Ω—Ç–∞ –ø—ã—Ç–∞—é—Ç—Å—è –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å 
—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ. **–£ –Ω–∞—Å –º–æ–∂–µ—Ç –±—ã—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π 
—á–∞—Å.**

–≠—Ç–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç–∏–≥–∞–µ—Ç—Å—è –∑–∞ —Å—á–µ—Ç –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–µ—Å–∫–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (–æ–ø–∏—Å–∞–Ω–Ω–æ–π –≤ 
[–ø—Ä–µ–¥—ã–¥—É—â–µ–π —Å—Ç–∞—Ç—å–µ](https://threedots.tech/post/repository-pattern-in-go/#updating-the-data)) –∏ 
–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –ø—Ä–µ–¥–º–µ—Ç–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏ (–æ–ø–∏—Å–∞–Ω–Ω—ã—Ö [–¥–≤–µ —Å—Ç–∞—Ç—å–∏ –Ω–∞–∑–∞–¥](https://threedots.tech/post/ddd-lite-in-go-introduction/#the-third-rule---domain-needs-to-be-database-agnostic)).

–î–∞–≤–∞–π—Ç–µ –ø—Ä–æ–≤–µ—Ä–∏–º, –º–æ–∂–Ω–æ –ª–∏ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —á–∞—Å –±–æ–ª–µ–µ 
–æ–¥–Ω–æ–≥–æ —Ä–∞–∑–∞. –ò–¥–µ—è –ø—Ä–æ—Å—Ç–∞: **—Å–æ–∑–¥–∞–¥–∏–º 20 –≥–æ—Ä—É—Ç–∏–Ω, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞–ø—É—Å—Ç–∏–º –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –∏
–ø–æ–ø—Ä–æ–±—É–µ–º –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É.** –ú—ã –æ–∂–∏–¥–∞–µ–º, —á—Ç–æ —ç—Ç–æ –ø–æ–ª—É—á–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ —É 
–æ–¥–Ω–æ–≥–æ worker–∞.

```go
func testUpdateHour_parallel(t *testing.T, repository hour.Repository) {
    // ...
    
    workersCount := 20
    workersDone := sync.WaitGroup{}
    workersDone.Add(workersCount)
    
    // –∑–∞–∫—Ä—ã—Ç–∏–µ startWorkers —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ—Ç –≤—Å–µ—Ö worker—ã —Å—Ä–∞–∑—É,
    // –±–ª–∞–≥–æ–¥–∞—Ä—è —ç—Ç–æ–º—É –±—É–¥–µ—Ç –±–æ–ª—å—à–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø–æ–ª—É—á–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≥–æ–Ω–∫–∏
    startWorkers := make(chan struct{})
    // –µ—Å–ª–∏ –æ–±—É—á–µ–Ω–∏–µ –±—ã–ª–æ —É—Å–ø–µ—à–Ω–æ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ, –Ω–æ–º–µ—Ä worker–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ —ç—Ç–æ—Ç –∫–∞–Ω–∞–ª
    trainingsScheduled := make(chan int, workersCount)
    
    // –º—ã –ø—ã—Ç–∞–µ–º—Å—è —Å–æ–∑–¥–∞—Ç—å —É—Å–ª–æ–≤–∏–µ –≥–æ–Ω–∫–∏, –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω worker –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –∑–∞–≤–µ—Ä—à–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
    for worker := 0; worker < workersCount; worker++ {
        workerNum := worker
    
        go func() {
            defer workersDone.Done()
            <-startWorkers
    
            schedulingTraining := false
    
            err := repository.UpdateHour(ctx, hourTime, func(h *hour.Hour) (*hour.Hour, error) {
                // —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ —É–∂–µ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∞, –Ω–∏—á–µ–≥–æ –¥–µ–ª–∞—Ç—å –Ω–µ –Ω—É–∂–Ω–æ
                if h.HasTrainingScheduled() {
                    return h, nil
                }
                // —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –µ—â–µ –Ω–µ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∞, —Ç–∞–∫ —á—Ç–æ –¥–∞–≤–∞–π—Ç–µ –ø–æ–ø—Ä–æ–±—É–µ–º —ç—Ç–æ —Å–¥–µ–ª–∞—Ç—å
                if err := h.ScheduleTraining(); err != nil {
                    return nil, err
                }
    
                schedulingTraining = true
    
                return h, nil
            })
    
            if schedulingTraining && err == nil {
                // –æ–±—É—á–µ–Ω–∏–µ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ —Ç–æ–º —Å–ª—É—á–∞–µ, –µ—Å–ª–∏ UpdateHour –Ω–µ –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É
                trainingsScheduled <- workerNum
            }
        }()
    }
    
    close(startWorkers)
    
    // –∂–¥—ë–º, –∫–æ–≥–¥–∞ –≤—Å–µ worker—ã –∑–∞–∫–æ–Ω—á–∞—Ç —Ä–∞–±–æ—Ç—É
    workersDone.Wait()
    close(trainingsScheduled)
    
    var workersScheduledTraining []int
    
    for workerNum := range trainingsScheduled {
        workersScheduledTraining = append(workersScheduledTraining, workerNum)
    }
    
    assert.Len(t, workersScheduledTraining, 1, "only one worker should schedule training")
}
```
–í–µ—Å—å –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥: [github.com/ThreeDotsLabs/wild-workouts-go-ddd-example/internal/trainer/hour_repository_test.go](https://github.com/ThreeDotsLabs/wild-workouts-go-ddd-example/blob/521fdb5d6aa4f1f7ff18ec33f50ce6710906d73b/internal/trainer/hour_repository_test.go#L128)

**–≠—Ç–æ —Ç–∞–∫–∂–µ —Ö–æ—Ä–æ—à–∏–π –ø—Ä–∏–º–µ—Ä —Ç–æ–≥–æ, —á—Ç–æ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ª–µ–≥—á–µ 
–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–º —Ç–µ—Å—Ç–µ, –∞ –Ω–µ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–µ–º–∫–∏ –∏–ª–∏ E2E.** –¢–∞–∫–∏–µ 
—Ç–µ—Å—Ç—ã, –∫–∞–∫ E2E, –±—É–¥—É—Ç –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ç—è–∂–µ–ª—ã–º–∏, –∏ –≤–∞–º –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –±–æ–ª—å—à–µ worker–æ–≤, 
—á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –æ–Ω–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.

## –£—Å–∫–æ—Ä–µ–Ω–∏–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤

–ï—Å–ª–∏ –≤–∞—à–∏ —Ç–µ—Å—Ç—ã –Ω–µ –º–æ–≥—É—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ, –æ–Ω–∏ –±—É–¥—É—Ç –º–µ–¥–ª–µ–Ω–Ω—ã–º–∏. –î–∞–∂–µ –Ω–∞ 
—Å–∞–º–æ–π –ª—É—á—à–µ–π –º–∞—à–∏–Ω–µ.

–î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è `t.Parallel()`? –ß—Ç–æ –∂, –Ω–∞–º –Ω—É–∂–Ω–æ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –Ω–∞—à–∏ 
—Ç–µ—Å—Ç—ã –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã. –í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ, –µ—Å–ª–∏ **–¥–≤–∞ —Ç–µ—Å—Ç–∞ –ø–æ–ø—ã—Ç–∞—é—Ç—Å—è –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å 
–æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —á–∞—Å, –æ–Ω–∏ –º–æ–≥—É—Ç –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è –Ω–µ—É–¥–∞—á–µ–π —Å–ª—É—á–∞–π–Ω—ã–º –æ–±—Ä–∞–∑–æ–º**. –≠—Ç–æ –∫—Ä–∞–π–Ω–µ 
–Ω–µ–∂–µ–ª–∞—Ç–µ–ª—å–Ω–∞—è —Å–∏—Ç—É–∞—Ü–∏—è.

–î–ª—è —ç—Ç–æ–≥–æ —è —Å–æ–∑–¥–∞–ª —Ñ—É–Ω–∫—Ü–∏—é `newValidHourTime()`, –∫–æ—Ç–æ—Ä–∞—è —Å–æ–∑–¥–∞—ë—Ç —Å–ª—É—á–∞–π–Ω—ã–π 
—á–∞—Å, —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –≤ —Ç–µ–∫—É—â–µ–º —Ç–µ—Å—Ç–æ–≤–æ–º –ø—Ä–æ–≥–æ–Ω–µ. –í –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –º–æ–∂–µ—Ç 
–±—ã—Ç—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ UUID –¥–ª—è –≤–∞—à–∏—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π.

–í –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö —ç—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–Ω–µ–µ –æ—á–µ–≤–∏–¥–Ω–æ, –Ω–æ –≤—Å–µ –∂–µ –≤–æ–∑–º–æ–∂–Ω–æ. –Ø 
—Ä–µ–∫–æ–º–µ–Ω–¥—É—é –≤–∞–º –ø–æ—Ç—Ä–∞—Ç–∏—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è, —á—Ç–æ–±—ã –Ω–∞–π—Ç–∏ —Ä–µ—à–µ–Ω–∏–µ. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, 
–æ—Ç–Ω–æ—Å–∏—Ç–µ—Å—å –∫ —ç—Ç–æ–º—É –∫–∞–∫ –∫ –≤–ª–æ–∂–µ–Ω–∏—é –≤ –ø—Å–∏—Ö–∏—á–µ—Å–∫–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ –≤–∞—Å –∏ –≤–∞—à–∏—Ö —Ç–æ–≤–∞—Ä–∏—â–µ–π 
–ø–æ –∫–æ–º–∞–Ω–¥–µ üòâ.

```go
// usedHours —Ö—Ä–∞–Ω–∏—Ç —á–∞—Å—ã, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –≤–æ –≤—Ä–µ–º—è —Ç–µ—Å—Ç–∞,
// —á—Ç–æ–±—ã –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å, —á—Ç–æ –≤ –æ–¥–Ω–æ–º —Ç–µ—Å—Ç–æ–≤–æ–º –ø—Ä–æ–≥–æ–Ω–µ –º—ã –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —á–∞—Å
// (–º–µ–∂–¥—É —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –∑–∞–ø—É—Å–∫–∞–º–∏ –ø—Ä–æ–±–ª–µ–º –±—ã—Ç—å –Ω–µ –¥–æ–ª–∂–Ω–æ)
var usedHours = sync.Map{}

func newValidHourTime() time.Time {
    for {
        minTime := time.Now().AddDate(0, 0, 1)
    
        minTimestamp := minTime.Unix()
        maxTimestamp := minTime.AddDate(0, 0, testHourFactory.Config().MaxWeeksInTheFutureToSet*7).Unix()
    
        t := time.Unix(rand.Int63n(maxTimestamp-minTimestamp)+minTimestamp, 0).Truncate(time.Hour).Local()
    
        _, alreadyUsed := usedHours.LoadOrStore(t.Unix(), true)
        if !alreadyUsed {
            return t
        }
    }
}
```
–í–µ—Å—å –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥: [github.com/ThreeDotsLabs/wild-workouts-go-ddd-example/internal/trainer/hour_repository_test.go](https://github.com/ThreeDotsLabs/wild-workouts-go-ddd-example/blob/521fdb5d6aa4f1f7ff18ec33f50ce6710906d73b/internal/trainer/hour_repository_test.go#L306)

–ï—â—ë –æ–¥–∏–Ω –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π –º–æ–º–µ–Ω—Ç –≤ —Ç–æ–º, —á—Ç–æ–±—ã –Ω–∞—à–∏ —Ç–µ—Å—Ç—ã –±—ã–ª–∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–º–∏, —Ç–∞–∫ 
—ç—Ç–æ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤ –æ—á–∏—Å—Ç–∫–µ –¥–∞–Ω–Ω—ã—Ö. –ü–æ –º–æ–µ–º—É –æ–ø—ã—Ç—É, –æ—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö 
–≤—Å–µ–≥–¥–∞ –±–µ—Å–ø–æ—Ä—è–¥–æ—á–Ω–∞—è, –ø–æ—Ç–æ–º—É —á—Ç–æ:

* –∫–æ–≥–¥–∞ –æ–Ω–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, —ç—Ç–æ —Å–æ–∑–¥–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—ã —Å –æ—Ç–ª–∞–¥–∫–æ–π –≤ —Ç–µ—Å—Ç–∞—Ö,
* —ç—Ç–æ –∑–∞–º–µ–¥–ª—è–µ—Ç —Ç–µ—Å—Ç—ã,
* —ç—Ç–æ –¥–æ–±–∞–≤–ª—è–µ—Ç –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É (–≤–∞–º –Ω—É–∂–Ω–æ –Ω–µ –∑–∞–±—ã—Ç—å –æ–±–Ω–æ–≤–ª—è—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –æ—á–∏—Å—Ç–∫–∏),
* —ç—Ç–æ –º–æ–∂–µ—Ç –∑–∞—Ç—Ä—É–¥–Ω–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤.

–¢–∞–∫–∂–µ –º–æ–∂–µ—Ç —Å–ª—É—á–∏—Ç—å—Å—è, —á—Ç–æ –º—ã –Ω–µ —Å–º–æ–∂–µ–º –∑–∞–ø—É—Å–∫–∞—Ç—å —Ç–µ—Å—Ç—ã –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ. –î–≤—É–º—è 
—Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã–º–∏ –ø—Ä–∏–º–µ—Ä–∞–º–∏ —è–≤–ª—è—é—Ç—Å—è:

* –ø–∞–≥–∏–Ω–∞—Ü–∏—è ‚Äî –µ—Å–ª–∏ –≤—ã –ø–µ—Ä–µ–±–∏—Ä–∞–µ—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã, –¥—Ä—É–≥–∏–µ —Ç–µ—Å—Ç—ã –º–æ–≥—É—Ç –ø–æ–º–µ—â–∞—Ç—å —á—Ç–æ-—Ç–æ –º–µ–∂–¥—É 
  –Ω–∏–º–∏ –∏ –ø–µ—Ä–µ–º–µ—â–∞—Ç—å ¬´—ç–ª–µ–º–µ–Ω—Ç—ã¬ª –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö.
* –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Å—á—ë—Ç—á–∏–∫–∏ ‚Äî –∫–∞–∫ –∏ –≤ —Å–ª—É—á–∞–µ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π, –¥—Ä—É–≥–∏–µ —Ç–µ—Å—Ç—ã –º–æ–≥—É—Ç –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–º 
  –æ–±—Ä–∞–∑–æ–º –ø–æ–≤–ª–∏—è—Ç—å –Ω–∞ —Å—á–µ—Ç—á–∏–∫.

–í —Ç–∞–∫–æ–º —Å–ª—É—á–∞–µ —Å—Ç–æ–∏—Ç —Å–¥–µ–ª–∞—Ç—å —ç—Ç–∏ —Ç–µ—Å—Ç—ã –∫–∞–∫ –º–æ–∂–Ω–æ –∫–æ—Ä–æ—á–µ.

### –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ sleep –≤ —Ç–µ—Å—Ç–∞—Ö!

–ü–æ—Å–ª–µ–¥–Ω–∏–π —Å–æ–≤–µ—Ç, –∫–æ—Ç–æ—Ä—ã–π –¥–µ–ª–∞–µ—Ç —Ç–µ—Å—Ç—ã –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã–º–∏ –∏ –º–µ–¥–ª–µ–Ω–Ω—ã–º–∏, - —ç—Ç–æ 
–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –Ω–∏—Ö —Ñ—É–Ω–∫—Ü–∏–∏ `sleep`. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, **–Ω–µ –¥–µ–ª–∞–π—Ç–µ —Ç–∞–∫**! –ù–∞–º–Ω–æ–≥–æ –ª—É—á—à–µ 
—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤–∞—à–∏ —Ç–µ—Å—Ç—ã —Å –∫–∞–Ω–∞–ª–∞–º–∏ –∏–ª–∏ `sync.WaitGroup{}`. –û–Ω–∏ –±—ã—Å—Ç—Ä–µ–µ –∏ 
—Å—Ç–∞–±–∏–ª—å–Ω–µ–µ.

–ï—Å–ª–∏ –≤–∞–º –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –Ω—É–∂–Ω–æ —á–µ–≥–æ-—Ç–æ –ø–æ–¥–æ–∂–¥–∞—Ç—å, –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å 
`assert.Eventually` –≤–º–µ—Å—Ç–æ `sleep`.

> `Eventually` –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç, —á—Ç–æ –∑–∞–¥–∞–Ω–Ω–æ–µ `condition` (—É—Å–ª–æ–≤–∏–µ) –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–æ –≤ —Ç–µ—á–µ–Ω–∏–µ 
> –≤—Ä–µ–º–µ–Ω–∏ `waitFor`, –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è—è —Ç—Ä–µ–±—É–µ–º—É—é —Ñ—É–Ω–∫—Ü–∏—é –∫–∞–∂–¥—ã–π —Ç–∏–∫.
> 
> ```go
> assert.Eventually(
>    t, 
>    func() bool { return true }, // —É—Å–ª–æ–≤–∏–µ
>    time.Second, // waitFor
>    10*time.Millisecond, // —Ç–∏–∫
> )
> ```
> [godoc.org/github.com/stretchr/testify/assert](https://godoc.org/github.com/stretchr/testify/assert#Eventually)

## –ó–∞–ø—É—Å–∫

–¢–µ–ø–µ—Ä—å, –∫–æ–≥–¥–∞ –Ω–∞—à–∏ —Ç–µ—Å—Ç—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã, –ø–æ—Ä–∞ –∏—Ö –∑–∞–ø—É—Å—Ç–∏—Ç—å!

–ü–µ—Ä–µ–¥ —ç—Ç–∏–º –Ω–∞–º –Ω—É–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –Ω–∞—à –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å Firebase –∏ MySQL —Å –ø–æ–º–æ—â—å—é 
`docker-compose up`.

–Ø –ø–æ–¥–≥–æ—Ç–æ–≤–∏–ª –∫–æ–º–∞–Ω–¥—É `make test`, –∫–æ—Ç–æ—Ä–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç —Ç–µ—Å—Ç—ã 
(–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ñ–ª–∞–≥ `-race`). –ï–≥–æ —Ç–∞–∫–∂–µ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ CI.

```shell
$ make test 

?      github.com/ThreeDotsLabs/wild-workouts-go-ddd-example/internal/common/auth [no test files]
?      github.com/ThreeDotsLabs/wild-workouts-go-ddd-example/internal/common/client   [no test files]
?      github.com/ThreeDotsLabs/wild-workouts-go-ddd-example/internal/common/genproto/trainer [no test files]
?      github.com/ThreeDotsLabs/wild-workouts-go-ddd-example/internal/common/genproto/users   [no test files]
?      github.com/ThreeDotsLabs/wild-workouts-go-ddd-example/internal/common/logs [no test files]
?      github.com/ThreeDotsLabs/wild-workouts-go-ddd-example/internal/common/server   [no test files]
?      github.com/ThreeDotsLabs/wild-workouts-go-ddd-example/internal/common/server/httperr   [no test files]
ok     github.com/ThreeDotsLabs/wild-workouts-go-ddd-example/internal/trainer 0.172s
ok     github.com/ThreeDotsLabs/wild-workouts-go-ddd-example/internal/trainer/domain/hour 0.031s
?      github.com/ThreeDotsLabs/wild-workouts-go-ddd-example/internal/trainings   [no test files]
?      github.com/ThreeDotsLabs/wild-workouts-go-ddd-example/internal/users   [no test files]
```

## –ó–∞–ø—É—Å–∫–∞–µ–º –æ–¥–∏–Ω —Ç–µ—Å—Ç –∏ –ø–µ—Ä–µ–¥–∞—ë–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø–µ—Ä–µ–¥–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –ø–æ–ª—É—á–∏—Ç—å –ø–æ–¥—Ä–æ–±–Ω—ã–π –≤—ã–≤–æ–¥ (-v) 
–∏–ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –æ–¥–∏–Ω –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ—Å—Ç (-run), –≤—ã –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–¥–∞—Ç—å –∏—Ö –ø–æ—Å–ª–µ 
`make test --`.

```shell
$ make test -- -v -run ^TestRepository/memory/testUpdateHour$ 

--- PASS: TestRepository (0.00s)
  --- PASS: TestRepository/memory (0.00s)
      --- PASS: TestRepository/memory/testUpdateHour (0.00s)
          --- PASS: TestRepository/memory/testUpdateHour/available_hour (0.00s)
          --- PASS: TestRepository/memory/testUpdateHour/not_available_hour (0.00s)
          --- PASS: TestRepository/memory/testUpdateHour/hour_with_training (0.00s)
PASS
```

–ï—Å–ª–∏ –≤–∞–º –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ, –∫–∞–∫ —ç—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ, –≤—Å—è –º–∞–≥–∏—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ 
[–º–æ—ë–º —Ñ–∞–π–ª–µ Makefile üßô‚Äç‚ôÇÔ∏è](https://github.com/ThreeDotsLabs/wild-workouts-go-ddd-example/blob/521fdb5d6aa4f1f7ff18ec33f50ce6710906d73b/Makefile#L60).

## –û—Ç–ª–∞–¥–∫–∞

–ò–Ω–æ–≥–¥–∞ –Ω–∞—à–∏ —Ç–µ—Å—Ç—ã –∑–∞–≤–µ—Ä—à–∞—é—Ç—Å—è —Å –æ—à–∏–±–∫–æ–π –ø–æ –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ–π –ø—Ä–∏—á–∏–Ω–µ. –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ 
–ø–æ–ª–µ–∑–Ω–æ –∏–º–µ—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ª–µ–≥–∫–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å, –∫–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ —É –Ω–∞—Å –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –Ω–∞—à–µ–π –±–∞–∑–µ 
–¥–∞–Ω–Ω—ã—Ö.

–î–ª—è SQL –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö —è –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞—é [mycli –¥–ª—è MySQL](https://www.mycli.net/install) –∏ [pgcli –¥–ª—è PostgreSQL](https://www.pgcli.com/). –Ø 
–¥–æ–±–∞–≤–∏–ª –∫–æ–º–∞–Ω–¥—É `make mycli` –≤ Makefile, –ø–æ—ç—Ç–æ–º—É –≤–∞–º –Ω–µ –Ω—É–∂–Ω–æ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å 
—É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.

```shell
$ make mycli

mysql user@localhost:db> SELECT * from `hours`;
+---------------------+--------------------+
| hour                | availability       |
|---------------------+--------------------|
| 2020-08-31 15:00:00 | available          |
| 2020-09-13 19:00:00 | training_scheduled |
| 2022-07-19 19:00:00 | training_scheduled |
| 2023-03-19 14:00:00 | available          |
| 2023-08-05 03:00:00 | training_scheduled |
| 2024-01-17 07:00:00 | not_available      |
| 2024-02-07 15:00:00 | available          |
| 2024-05-07 18:00:00 | training_scheduled |
| 2024-05-22 09:00:00 | available          |
| 2025-03-04 15:00:00 | available          |
| 2025-04-15 08:00:00 | training_scheduled |
| 2026-05-22 09:00:00 | training_scheduled |
| 2028-01-24 18:00:00 | not_available      |
| 2028-07-09 00:00:00 | not_available      |
| 2029-09-23 15:00:00 | training_scheduled |
+---------------------+--------------------+
15 rows in set
Time: 0.025s
```

–î–ª—è Firestore —ç–º—É–ª—è—Ç–æ—Ä –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ –∞–¥—Ä–µ—Å—É
[http://localhost:4000/firestore/](http://localhost:4000/firestore/).

![firestore-console](images/part8/firestore-console.png)

## –ü–µ—Ä–≤—ã–π —à–∞–≥ –∫ —Å–æ–∑–¥–∞–Ω–∏—é —Ö–æ—Ä–æ—à–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

–°–∞–º—ã–π –±–æ–ª—å—à–æ–π –ø—Ä–æ–±–µ–ª, –∫–æ—Ç–æ—Ä—ã–π —É –Ω–∞—Å —Å–µ–π—á–∞—Å –µ—Å—Ç—å, - —ç—Ç–æ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ç–µ—Å—Ç–æ–≤ –Ω–∞ 
—É—Ä–æ–≤–Ω–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∏ E2E. –ö—Ä–æ–º–µ —Ç–æ–≥–æ, –±–æ–ª—å—à–∞—è —á–∞—Å—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤–æ–æ–±—â–µ –Ω–µ 
—Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è. –ú—ã –∏—Å–ø—Ä–∞–≤–∏–º —ç—Ç–æ –≤ —Å–ª–µ–¥—É—é—â–∏—Ö —Å—Ç–∞—Ç—å—è—Ö. –ú—ã —Ç–∞–∫–∂–µ –∑–∞—Ç—Ä–æ–Ω–µ–º –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ 
—Ç–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–ø—É—Å—Ç–∏–ª–∏ –≤ —ç—Ç–æ—Ç —Ä–∞–∑.

–ù–æ –ø–µ—Ä–µ–¥ —ç—Ç–∏–º —É –Ω–∞—Å –µ—Å—Ç—å –æ–¥–Ω–∞ —Ç–µ–º–∞, –∫–æ—Ç–æ—Ä—É—é –º—ã –¥–æ–ª–∂–Ω—ã –±—ã–ª–∏ –∑–∞—Ç—Ä–æ–Ω—É—Ç—å —Ä–∞–Ω–µ–µ ‚Äî 
—á–∏—Å—Ç–∞—è/–≥–µ–∫—Å–∞–≥–æ–Ω–∞–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞! –¢–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥ –ø–æ–º–æ–∂–µ—Ç –Ω–∞–º –Ω–µ–º–Ω–æ–≥–æ —É–ø–æ—Ä—è–¥–æ—á–∏—Ç—å 
–Ω–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ —É–ø—Ä–æ—Å—Ç–∏—Ç –±—É–¥—É—â–∏–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –Ω–æ–≤–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞.

–ù–∞–ø–æ–º–Ω–∏–º, **–≤–µ—Å—å –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ Wild Workouts [–¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ GitHub](https://github.com/ThreeDotsLabs/wild-workouts-go-ddd-example/). –í—ã –º–æ–∂–µ—Ç–µ 
–∑–∞–ø—É—Å—Ç–∏—Ç—å –µ–≥–æ –ª–æ–∫–∞–ª—å–Ω–æ –∏ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å –≤ Google Cloud —Å –ø–æ–º–æ—â—å—é –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥—ã.**

–í–∞–º –ø–æ–Ω—Ä–∞–≤–∏–ª–∞—Å—å —ç—Ç–∞ —Å—Ç–∞—Ç—å—è, –Ω–æ –Ω–µ –±—ã–ª–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø—Ä–æ—á–∏—Ç–∞—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–∏–µ? –°–∞–º–æ–µ –≤—Ä–µ–º—è –Ω–∞–≤–µ—Ä—Å—Ç–∞—Ç—å!
–ï—â—ë —Ü–µ–ª—ã—Ö 7 —Å—Ç–∞—Ç–µ–π, –∫–æ—Ç–æ—Ä—ã–µ —Å—Ç–æ–∏—Ç –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å!

–ù–∞ —Å–µ–≥–æ–¥–Ω—è –≤—Å–µ. –î–æ —Å–∫–æ—Ä–æ–π –≤—Å—Ç—Ä–µ—á–∏! üôÇ